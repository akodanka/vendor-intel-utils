From 0480a7fd3a0158cf7dcb4412fd0d0aadf20c96c6 Mon Sep 17 00:00:00 2001
From: akodanka <anoob.anto.kodankandath@gmail.com>
Date: Tue, 19 Feb 2019 01:26:40 +0530
Subject: [PATCH] Dual Hdmi Playback frameworks/av

Change-Id: I476968168ecf59dc93b09522f778783c7ca18f4a
Tracked-On:
Signed-off-by: akodanka <anoob.anto.kodankandath@gmail.com>
---
 media/libaudioclient/AudioTrack.cpp | 5 +++++
 media/libmedia/TypeConverter.cpp    | 1 +
 2 files changed, 6 insertions(+)

diff --git a/media/libaudioclient/AudioTrack.cpp b/media/libaudioclient/AudioTrack.cpp
index ab9efe8893..3ec79acf48 100644
--- a/media/libaudioclient/AudioTrack.cpp
+++ b/media/libaudioclient/AudioTrack.cpp
@@ -465,6 +465,11 @@ status_t AudioTrack::set(
         if (flags == AUDIO_OUTPUT_FLAG_NONE && (mAttributes.flags & AUDIO_FLAG_DEEP_BUFFER) != 0) {
             flags = AUDIO_OUTPUT_FLAG_DEEP_BUFFER;
         }
+        // check secondary output after flags have been modified above
+        if ((mAttributes.flags & AUDIO_FLAG_SECONDARY_OUT) != 0) {
+            flags = (audio_output_flags_t) (flags | AUDIO_OUTPUT_FLAG_SECONDARY_OUT);
+            ALOGD("Added AUDIO_OUTPUT_FLAG_SECONDARY_OUT to flags = %04x", flags);
+        }
     }
 
     // these below should probably come from the audioFlinger too...
diff --git a/media/libmedia/TypeConverter.cpp b/media/libmedia/TypeConverter.cpp
index a3db754637..07d25222e6 100644
--- a/media/libmedia/TypeConverter.cpp
+++ b/media/libmedia/TypeConverter.cpp
@@ -114,6 +114,7 @@ const OutputFlagConverter::Table OutputFlagConverter::mTable[] = {
     MAKE_STRING_FROM_ENUM(AUDIO_OUTPUT_FLAG_RAW),
     MAKE_STRING_FROM_ENUM(AUDIO_OUTPUT_FLAG_SYNC),
     MAKE_STRING_FROM_ENUM(AUDIO_OUTPUT_FLAG_IEC958_NONAUDIO),
+    MAKE_STRING_FROM_ENUM(AUDIO_OUTPUT_FLAG_SECONDARY_OUT),
     MAKE_STRING_FROM_ENUM(AUDIO_OUTPUT_FLAG_DIRECT_PCM),
     MAKE_STRING_FROM_ENUM(AUDIO_OUTPUT_FLAG_MMAP_NOIRQ),
     MAKE_STRING_FROM_ENUM(AUDIO_OUTPUT_FLAG_VOIP_RX),
-- 
2.20.1

