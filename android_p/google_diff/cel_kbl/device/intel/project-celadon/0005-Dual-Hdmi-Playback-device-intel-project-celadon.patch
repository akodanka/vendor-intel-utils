From 1d2e75fc32c4e40d4efda116696b63e3e0d7a1bf Mon Sep 17 00:00:00 2001
From: akodanka <anoob.anto.kodankandath@gmail.com>
Date: Tue, 19 Feb 2019 02:28:27 +0530
Subject: [PATCH] Dual Hdmi Playback /device/intel/project-celadon/

Tracked-On:
Signed-off-by: akodanka <anoob.anto.kodankandath@gmail.com>
---
 .../policy/audio_policy_configuration.xml        | 16 +++++++++++++++-
 .../Structure/PolicySubsystem-CommonTypes.xml    |  1 +
 2 files changed, 16 insertions(+), 1 deletion(-)

diff --git a/common/audio/default/policy/audio_policy_configuration.xml b/common/audio/default/policy/audio_policy_configuration.xml
index 8fc13ab..6f9bb99 100644
--- a/common/audio/default/policy/audio_policy_configuration.xml
+++ b/common/audio/default/policy/audio_policy_configuration.xml
@@ -23,6 +23,8 @@
         <module name="primary" halVersion="3.0">
             <attachedDevices>
                 <item>Speaker</item>
+                <item>HDMI</item>
+                <item>HDMI_SECONDARY</item>
                 <item>Built-In Mic</item>
             </attachedDevices>
             <defaultOutputDevice>Speaker</defaultOutputDevice>
@@ -35,6 +37,10 @@
                     <profile name="" format="AUDIO_FORMAT_PCM_16_BIT"
                              samplingRates="48000" channelMasks="AUDIO_CHANNEL_OUT_STEREO"/>
                 </mixPort>
+                <mixPort name="hdmi_stereo_secondary" role="source" flags="AUDIO_OUTPUT_FLAG_SECONDARY_OUT">
+                    <profile name="" format="AUDIO_FORMAT_PCM_16_BIT"
+                             samplingRates="48000" channelMasks="AUDIO_CHANNEL_OUT_STEREO"/>
+                </mixPort>
                 <mixPort name="hdmi_multi" role="source" flags="AUDIO_OUTPUT_FLAG_DIRECT">
                     <profile name="" format="AUDIO_FORMAT_PCM_16_BIT"
                              samplingRates="48000"/>
@@ -72,7 +78,13 @@
                              channelMasks="AUDIO_CHANNEL_IN_MONO,AUDIO_CHANNEL_IN_STEREO"/>
                 </devicePort>
 
-                <devicePort tagName="HDMI" type="AUDIO_DEVICE_OUT_HDMI" role="sink">
+                <devicePort tagName="HDMI" type="AUDIO_DEVICE_OUT_HDMI" role="sink" address="HDMI">
+                    <profile name="" format="AUDIO_FORMAT_PCM_16_BIT"
+                             samplingRates="48000" channelMasks="AUDIO_CHANNEL_OUT_STEREO"/>
+                    <profile name="" format="AUDIO_FORMAT_PCM_16_BIT"
+                             samplingRates="32000,44100,48000"/>
+                </devicePort>
+                <devicePort tagName="HDMI_SECONDARY" type="AUDIO_DEVICE_OUT_HDMI" role="sink" address="HDMI_SECONDARY">
                     <profile name="" format="AUDIO_FORMAT_PCM_16_BIT"
                              samplingRates="48000" channelMasks="AUDIO_CHANNEL_OUT_STEREO"/>
                     <profile name="" format="AUDIO_FORMAT_PCM_16_BIT"
@@ -89,6 +101,8 @@
                        sources="primary_output"/>
                 <route type="mix" sink="HDMI"
                        sources="hdmi_stereo,hdmi_multi"/>
+                <route type="mix" sink="HDMI_SECONDARY"
+                       sources="hdmi_stereo_secondary"/>
                 <route type="mix" sink="primary_input"
                        sources="Wired Headset Mic,Built-In Mic"/>
             </routes>
diff --git a/common/audio/reference_configurable_audio_policy/Structure/PolicySubsystem-CommonTypes.xml b/common/audio/reference_configurable_audio_policy/Structure/PolicySubsystem-CommonTypes.xml
index 9d6c6ca..fcfa2db 100644
--- a/common/audio/reference_configurable_audio_policy/Structure/PolicySubsystem-CommonTypes.xml
+++ b/common/audio/reference_configurable_audio_policy/Structure/PolicySubsystem-CommonTypes.xml
@@ -94,6 +94,7 @@
             <BitParameter Name="raw" Size="1" Pos="8"/>
             <BitParameter Name="sync" Size="1" Pos="9"/>
             <BitParameter Name="iec958_nonaudio" Size="1" Pos="10"/>
+            <BitParameter Name="secondary_out" Size="1" Pos="11"/>
         </BitParameterBlock>
     </ComponentType>
 
-- 
2.20.1

